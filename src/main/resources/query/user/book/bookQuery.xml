<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="com.youngsuk.bookstore.repository.BookRepository">
    <resultMap id="DBNameMappingBookDTO" type="com.youngsuk.bookstore.dto.BookDto">
        <result column="id" property="bookId" />
        <result column="book_name" property="bookName" />
        <result column="book_category" property="bookCategory" />
        <result column="book_introduce" property="bookIntroduce" />
        <result column="author_introduce" property="bookAuthorIntroduce" />
        <result column="book_index_text" property="bookIndexText" />
        <result column="author_name" property="bookAuthorName" />
        <result column="book_publish_date" property="bookPublishDate" />
        <result column="book_cost" property="bookCost" />
        <result column="book_like_count" property="bookLikeCount" />
    </resultMap>

    <select id="selectBookByCategory" parameterType="com.youngsuk.bookstore.dto.BookDto" resultMap="DBNameMappingBookDTO">
        SELECT
            book.book_name, book.book_category,
            author.author_name, book.book_publish_date,
            book.book_cost, book.book_like_count
        FROM
            book
        LEFT JOIN
            author
        ON
            book.id = author.id
        WHERE
            book.id NOT IN(#{pagingDto.lastId})
        AND
        book_category = #{bookCategory}

        <if test="sortTypeEnum == @com.youngsuk.bookstore.common.utils.constants.SortTypeEnum
                @Newest">
            AND
                #{pagingDto.pagingCursor} >= book.book_publish_date
            ORDER BY
                book.book_publish_date
        </if>
        <if test="sortTypeEnum == @com.youngsuk.bookstore.common.utils.constants.SortTypeEnum
                @Likes">
            AND
                #{pagingDto.pagingCursor} >= book.book_like_count
            ORDER BY
                book.book_like_count
        </if>

        DESC LIMIT
            #{pagingDto.onePageLimit};
    </select>

</mapper>

