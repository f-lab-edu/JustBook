<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="com.youngsuk.bookstore.repository.BookRepository">
    <!--table을 full scan 하는 이유는 책의 카테고리 개수만큼만 가져오기 때문이다-->
    <select id="findBookByCategoryList" resultType="com.youngsuk.bookstore.dto.BookCategoryDto">
        SELECT
            bookCategoryCode, bookCategoryName
        FROM
            bookCategoryCodeTable
    </select>

    <select id="selectBookByCategory" resultType="com.youngsuk.bookstore.dto.BookDto">
        SELECT
        bookName, authorName, bookPublishDate,
        bookCost, bookLikeCount
        FROM
            bookProductTable
        LEFT JOIN
        author
        ON
        bookIdPk = authorIdPk
        WHERE
        bookIdPk NOT IN(#{pagingDto.lastId})
        AND
        bookCategory = #{bookCategory}

        <if test='sortTypeEnum == sortTypeEnum.getNewest()'>
            AND
            #{pagingDto.pagingCursor} >= bookPublishDate
            ORDER BY
            bookPublishDate
        </if>
        <if test='sortTypeEnum == sortTypeEnum.getLikes()'>
            AND
            #{pagingDto.pagingCursor} >= bookLikeCount
            ORDER BY
            bookLikeCount
        </if>

        DESC LIMIT
        #{pagingDto.onePageLimit};
    </select>
</mapper>